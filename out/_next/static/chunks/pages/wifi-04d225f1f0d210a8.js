(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[281],{503:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/wifi",function(){return n(8381)}])},802:function(e,t,n){"use strict";n.d(t,{d:function(){return c},z:function(){return l}});var r=n(5893),a=n(7294),i=n(8426),o=n(2003),s=n(7537);let c=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=a.forwardRef((e,t)=>{let{className:n,variant:a,size:o,asChild:l=!1,...u}=e,d=l?i.g7:"button";return(0,r.jsx)(d,{className:(0,s.cn)(c({variant:a,size:o,className:n})),ref:t,...u})});l.displayName="Button"},1473:function(e,t,n){"use strict";n.d(t,{uT:function(){return f},Od:function(){return h},I_:function(){return g},GI:function(){return w},M7:function(){return v},sc:function(){return m},wl:function(){return p},Sj:function(){return x},b:function(){return y},Hu:function(){return b},Cz:function(){return j}});var r=n(9734),a=n(8893),i=n(5752),o=n(7478),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,o.H_)(async()=>{try{var n,r;if(!(null===(r=window.pywebview)||void 0===r?void 0:null===(n=r.api)||void 0===n?void 0:n[e]))throw Error("API endpoint not found");await (0,a.Z)("PyCall ".concat(e),t);let i=await window.pywebview.api[e](t).then(e=>JSON.parse(e)).then(async t=>{if(null==t?void 0:t.error)throw t.error;if(void 0===t.message)throw Error("Response message was empty ".concat(t));return await (0,a.Z)("Pycall ".concat(e," returned: ").concat(t.message),t),t.message});return i}catch(n){let t="".concat(n);throw n instanceof Error&&(t=n.message),await (0,a.Z)("Pycall ".concat(e," (retrying): ").concat(t)),Error(t)}},i.Z.RETRY_DELAY,i.Z.MAX_RETRIES).catch(async t=>{let n="".concat(e," - ").concat(t);throw t instanceof Error&&(n=t.message),await (0,a.Z)("Pycall ".concat(e," - FATAL ERROR: ").concat(n)),Error(n)})};let c=e=>s("get",{key:e}).then(e=>{console.log("Got: ",e);try{return JSON.parse(e)}catch(t){return e}}).catch(e=>(console.log("pyget error: ".concat(e)),"")),l=(e,t)=>(console.log("Setting: ".concat(e,", ").concat(t)),s("set",{key:e,data:t}).catch(e=>(console.log("Pyset error: ",e),""))),u=()=>s("deviceOn").catch(()=>"error"),d=()=>s("deviceOff").catch(()=>"error"),f=()=>s("getDeviceStatus").catch(()=>"error"),h=()=>s("getHardwareId").catch(()=>""),w=async()=>{let e=await (0,o.Vs)(s("checkWifiConnection").catch(()=>!1),i.Z.NETWORK_TIMEOUT);return e},g=()=>s("getIpAddress").catch(()=>""),v=()=>c("network_list"),m=async()=>{let e=await s("getTemperatureHumidity").catch(()=>({temperature:"---",humidity:"---"}));return e},p=async()=>{let e=await s("getWifiInfo").catch(()=>({ssid:"error",quality:0})),t=Math.round(Number.parseInt(e.quality,10)/70*100);return{ssid:e.ssid,quality:t}},x=async()=>{let e=await s("getWifiNetworks").catch(()=>""),t=e.split("ESSID:").map(e=>e.trim().replace(/^"|"$/g,"")).filter((e,t,n)=>n.indexOf(e)===t).filter(e=>e);return t},y=async e=>{console.log("setDevicePower> Setting device power to ".concat(e)),await (0,r.JG)("/device-power",e),e?console.log(await u()):console.log(await d())},j=async(e,t)=>{let n=await s("setWifiNetwork",{ssid:e,password:t});return n},b=async(e,t)=>{let n=await c("network_list"),r="object"==typeof n?await l("network_list",{...n,[e]:t}):await l("network_list",{[e]:t});return r}},8893:function(e,t,n){"use strict";var r=n(5752),a=n(7478);let i=async function(e){for(var t,n,i=arguments.length,o=Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];(null===(n=window.pywebview)||void 0===n?void 0:null===(t=n.api)||void 0===t?void 0:t.log)?(console.log("[Pylog] ".concat(e),...o),await (0,a.Vs)((async()=>(await window.pywebview.api.log(e),!0))(),r.Z.TIMEOUT).catch(t=>console.log("[Pylog] ".concat(e," error: ").concat(t)))):console.log("[Pylog Error] ".concat(e),...o)};t.Z=i},8381:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var r=n(5893),a=n(7294),i=n(4011),o=n(452),s=n(7920),c=n(9162),l=n(2217),u=n(2992),d=n(3217),f=n(2888),h=n(4464),w=n(1607),g=n(1664),v=n.n(g),m=n(9734),p=n(802),x=n(7537),y=n(1473),j=n(5752),b=e=>{let{data:t,error:n,mutate:r}=(0,m.ZP)("/wifi-info",y.wl,{refreshInterval:j.Z.NETWORK_TIMEOUT,refreshWhenHidden:!1,refreshWhenOffline:!0,revalidateIfStale:!0,revalidateOnFocus:!0,revalidateOnReconnect:!0,...e});return{data:t,mutate:r,isLoading:!n&&!t,isError:n}},E=n(8893);let Z="w-full h-full flex gap-2";var N=()=>{let{data:e,mutate:t,isError:n}=b(),{data:g}=(0,m.ZP)("/saved-networks",y.M7),N=(0,a.useRef)(null),P=(0,a.useRef)(null),[_,O]=(0,a.useState)(""),[S,T]=(0,a.useState)([]),[I,k]=(0,a.useState)(""),[C,R]=(0,a.useState)(!0),[W,F]=(0,a.useState)(!0),[z,H]=(0,a.useState)(!1),M=async()=>{F(!0);let e=await (0,y.Sj)();console.log(e),T(e),F(!1)},A=()=>{!I&&(null==e?void 0:e.ssid)&&(null==g?void 0:g[e.ssid])&&k(g[e.ssid])},D=async()=>{_&&(H(!0),await (0,E.Z)("WiFi Connect ".concat(_,":").concat(I)),await (0,y.Cz)(_,I).then(e=>(0,E.Z)("Connect WiFi: ".concat(e))).catch(async e=>{await (0,E.Z)("WiFi Error: ".concat(e))}),setTimeout(()=>{(0,y.GI)().then(async()=>{await (0,y.Hu)(_,I),console.log("Connected, saved network".concat(_,":").concat(I))}).finally(()=>{t(),H(!1)})},j.Z.NETWORK_TIMEOUT))};return(0,a.useEffect)(()=>{M()},[]),(0,a.useEffect)(()=>{!_&&(null==e?void 0:e.ssid)?O(e.ssid):!_&&S&&S[0]&&O(S[0])},[e,S]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"block text-center",children:[!e&&!n&&(0,r.jsx)("p",{children:"Getting WiFi information..."})||n?(0,r.jsx)("p",{children:"Enter your WiFi name (SSID) and password to connect."}):(0,r.jsxs)("h3",{children:[null==e?void 0:e.ssid," ",null==e?void 0:e.quality," ",(0,r.jsx)(s.Z,{})]}),(0,r.jsxs)(c.ZP,{container:!0,direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,children:[(0,r.jsx)(c.ZP,{item:!0,xs:9,children:S&&(0,r.jsx)(l.Z,{autoComplete:!0,autoHighlight:!0,clearOnEscape:!0,freeSolo:!0,openOnFocus:!0,ref:N,disabled:W||z,options:S,sx:{width:"100%"},renderInput:e=>(0,r.jsx)(u.Z,{...e,label:"Network"}),inputValue:_,onChange:(e,t)=>{t&&(O(t),A())},onBlur:A,onInputChange:(e,t)=>{O(t)}})}),(0,r.jsx)(c.ZP,{item:!0,xs:3,children:(0,r.jsxs)(p.z,{onClick:M,className:"text-md flex h-full w-full gap-2",children:[W?(0,r.jsx)(d.Z,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(f.Z,{})," ","Refresh"]})}),(0,r.jsx)(c.ZP,{item:!0,xs:9,children:(0,r.jsx)(u.Z,{ref:P,label:"Password",variant:"outlined",value:I,sx:{width:"100%"},type:C?"password":"text",onChange:e=>{var t;k(null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.value)}})}),(0,r.jsx)(c.ZP,{item:!0,xs:3,children:(0,r.jsx)(p.z,{onClick:()=>R(!C),className:"text-md flex h-full w-full gap-2",children:C?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.Z,{})," Show"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.Z,{})," Hide"]})})}),(0,r.jsxs)("div",{className:"grid grid-cols-2",children:[(0,r.jsxs)(p.z,{onClick:D,className:(0,x.cn)(Z,"text-xl"),children:[W||z?(0,r.jsx)(d.Z,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(i.Z,{fontSize:"inherit"}),"Connect"]}),(0,r.jsx)(p.z,{disabled:!(null==e?void 0:e.ssid),className:(0,x.cn)(Z,"text-xl"),children:(null==e?void 0:e.ssid)?(0,r.jsxs)(v(),{href:"/dashboard",children:["Dashboard ",(0,r.jsx)(o.Z,{})]}):(0,r.jsxs)(r.Fragment,{children:["Dashboard ",(0,r.jsx)(o.Z,{})]})})]})]})]})})}},7478:function(e,t,n){"use strict";n.d(t,{H_:function(){return i},Vs:function(){return r}});let r=(e,t)=>{let n;return Promise.race([e,new Promise((e,r)=>n=setTimeout(()=>r(Error("timeout")),t))]).finally(()=>clearTimeout(n))},a=e=>new Promise(t=>setTimeout(t,e)),i=(e,t,n)=>new Promise((r,o)=>e().then(r).catch(s=>n>0?a(t).then(i.bind(null,e,t,n-1)).then(r).catch(e=>{let t="Operation failed";e instanceof Error&&(t=e.message),o(t)}):o(s)))}},function(e){e.O(0,[664,734,646,807,774,888,179],function(){return e(e.s=503)}),_N_E=e.O()}]);